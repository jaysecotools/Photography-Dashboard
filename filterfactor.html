<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Filter Factor Calculator</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; transition: background 0.3s, color 0.3s; }
  .tool-card { background: #fff; padding: 20px; max-width: 420px; margin: auto; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); transition: background 0.3s, color 0.3s; }
  h2 { margin-top: 0; font-size: 1.4em; }
  p.instructions { font-size: 0.9em; color: #555; margin-top: 0; margin-bottom: 15px; transition: color 0.3s; }
  label { display: block; margin-top: 12px; font-weight: bold; }
  input, select, button { width: 100%; padding: 8px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc; font-size: 1em; }
  button { margin-top: 15px; background: #0073e6; color: #fff; border: none; cursor: pointer; }
  button:hover { background: #005bb5; }
  .result-box { margin-top: 15px; padding: 12px; background: #f0f0f0; border-radius: 6px; transition: background 0.3s, color 0.3s; }
  .dark-mode { background: #1c1c1c; color: #f0f0f0; }
  .dark-mode .tool-card { background: #2c2c2c; color: #f0f0f0; }
  .dark-mode .result-box { background: #3a3a3a; color: #f0f0f0; }
  .dark-mode input, .dark-mode select { background: #555; color: #f0f0f0; border: 1px solid #888; }
</style>
</head>
<body>
<div class="tool-card">
  <h2>Filter Factor Calculator</h2>
  <p class="instructions">
    Select a filter or enter a custom factor. Optionally, choose a shutter speed to see the corrected exposure.  
    Results are rounded to standard camera shutter speeds.
  </p>

  <label for="filterSelect">Choose Filter:</label>
  <select id="filterSelect">
    <option value="">-- none --</option>
    <option value="2">Yellow (2x = +1 stop)</option>
    <option value="4">Orange (4x = +2 stops)</option>
    <option value="8">Red (8x = +3 stops)</option>
    <option value="16">ND16 (16x = +4 stops)</option>
    <option value="32">ND32 (32x = +5 stops)</option>
  </select>

  <label for="customFactor">Or enter custom factor (e.g. 2, 4, 8):</label>
  <input type="number" id="customFactor" placeholder="Enter factor">

  <label for="fastShutter">Fast Shutter (fractions):</label>
  <select id="fastShutter">
    <option value="">-- none --</option>
    <option value="1/8000">1/8000</option>
    <option value="1/4000">1/4000</option>
    <option value="1/2000">1/2000</option>
    <option value="1/1000">1/1000</option>
    <option value="1/500">1/500</option>
    <option value="1/250">1/250</option>
    <option value="1/125">1/125</option>
    <option value="1/60">1/60</option>
    <option value="1/30">1/30</option>
  </select>

  <label for="longShutter">Long Shutter (seconds):</label>
  <select id="longShutter">
    <option value="">-- none --</option>
    <option value="1">1s</option>
    <option value="2">2s</option>
    <option value="4">4s</option>
    <option value="8">8s</option>
    <option value="15">15s</option>
    <option value="30">30s</option>
  </select>

  <button onclick="calculateFilter()">Calculate</button>
  <button onclick="toggleDarkMode()">Toggle Dark Mode</button>

  <div id="filterResult" class="result-box"></div>
</div>

<script>
const standardShutters=[1/8000,1/4000,1/2000,1/1000,1/500,1/250,1/125,1/60,1/30,1/15,1/8,1/4,1/2,1,2,4,8,15,30];

function parseShutterValue(fast,long){
  if(fast){const p=fast.split("/");return parseFloat(p[0])/parseFloat(p[1]);}
  if(long) return parseFloat(long);
  return null;
}

function nearestShutter(seconds){
  let closest=standardShutters[0]; let minDiff=Math.abs(seconds-closest);
  for(const s of standardShutters){
    const diff=Math.abs(seconds-s);
    if(diff<minDiff){closest=s; minDiff=diff;}
  }
  return closest;
}

function formatShutter(seconds){
  const nearest=nearestShutter(seconds);
  if(nearest>=1) return nearest+"s";
  return "1/"+Math.round(1/nearest);
}

function calculateFilter(){
  const filterSelect=document.getElementById("filterSelect").value;
  const customFactor=parseFloat(document.getElementById("customFactor").value);
  const fastShutter=document.getElementById("fastShutter").value;
  const longShutter=document.getElementById("longShutter").value;
  const resultBox=document.getElementById("filterResult");

  let factor=0;
  if(customFactor&&customFactor>0) factor=customFactor;
  else if(filterSelect) factor=parseFloat(filterSelect);

  if(!factor){resultBox.innerHTML="⚠️ Please select a filter or enter a factor."; return;}

  const stops=Math.log2(factor);
  let message=`Filter Factor: <b>${factor}x</b><br>Exposure Compensation: <b>+${stops.toFixed(2)} stops</b>`;

  const base=parseShutterValue(fastShutter,longShutter);
  if(base){
    const newShutter=base*factor;
    message+=`<br>Adjusted Shutter: <b>${formatShutter(newShutter)}</b>`;
  }

  resultBox.innerHTML=message;
}

function toggleDarkMode(){document.body.classList.toggle("dark-mode");}
</script>
</body>
</html>
